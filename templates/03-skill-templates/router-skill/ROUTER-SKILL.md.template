# Router/Hub SKILL.md Template

## Purpose

Template for creating hub/router skills that intelligently route requests to specialized skills. Based on proven patterns from jira-assistant (13 skills, 1600+ tests).

## Key Insight

> **"The LLM IS the Router"** - SKILL.md provides instructions for Claude, not configuration for code. Natural language certainty replaces computed confidence scores.

## Placeholders

- `{{TOPIC}}` - Lowercase prefix (e.g., "jira", "github", "confluence")
- `{{API_NAME}}` - Friendly API name (e.g., "JIRA", "GitHub", "Confluence")
- `{{SKILL_COUNT}}` - Number of specialized skills
- `{{QUICK_REFERENCE_TABLE}}` - Routing table with risk levels
- `{{ROUTING_RULES}}` - Keyword-based routing rules
- `{{NEGATIVE_TRIGGERS_TABLE}}` - What each skill does NOT handle
- `{{DISAMBIGUATION_EXAMPLES}}` - Ambiguous request examples
- `{{COMMON_WORKFLOWS}}` - Multi-skill workflow examples

## Token Budget

- **Target**: 150-200 lines (under 8,000 tokens combined with skills)
- **Hard limit**: 200 lines for hub SKILL.md
- Move detailed content to `docs/` for progressive disclosure

---

## Template

```markdown
---
name: "{{TOPIC}}-assistant"
description: "{{API_NAME}} automation hub routing to {{SKILL_COUNT}} specialized skills for any {{API_NAME}} task. Use this skill when working with {{API_NAME}} in any capacity."
version: "1.0.0"
author: "{{author}}"
license: "MIT"
allowed-tools: ["Bash", "Read", "Glob", "Grep"]
---

# {{API_NAME}} Assistant

This hub routes requests to specialized {{API_NAME}} skills. It does not execute {{API_NAME}} operations directly—it helps find the right skill.

## Quick Reference

| I want to... | Use this skill | Risk |
|--------------|----------------|:----:|
{{QUICK_REFERENCE_TABLE}}

**Risk Legend**: `-` Read-only/safe | `⚠️` Has destructive ops (confirm) | `⚠️⚠️` High-risk (confirm + dry-run)

---

## Routing Rules

1. **Explicit skill mention wins** - If user says "use {{TOPIC}}-search", use it
2. **Entity signals** - Resource ID/key present → likely CRUD skill
3. **Quantity determines bulk** - More than 10 items → bulk skill
4. **Keywords drive routing**:
{{ROUTING_RULES}}

---

## Negative Triggers

| Skill | Does NOT handle | Route to instead |
|-------|-----------------|------------------|
{{NEGATIVE_TRIGGERS_TABLE}}

---

## When to Clarify First

Ask the user before routing when:
- Request matches 2+ skills with similar likelihood
- Request is vague or could be interpreted multiple ways
- Destructive operations are implied

### Disambiguation Examples

{{DISAMBIGUATION_EXAMPLES}}

---

## Context Awareness

### Pronoun Resolution

When user says "it" or "that":
- If exactly one entity mentioned in last 3 messages → use it
- If multiple entities mentioned → ask: "Which one - X or Y?"
- If no entity in last 5 messages → ask: "Which are you referring to?"

**After CREATE**:
```
User: "create a resource in PROJECT" → RES-123 created
User: "update it"
→ "it" = RES-123 (the resource just created)
```

**After SEARCH**:
```
User: "find all active items" → Found RES-100, RES-101, RES-102
User: "delete them"
→ "them" = the search results (use bulk skill)
```

### Scope Persistence

When user mentions a scope (project, container, etc.):
- Remember it for subsequent requests in this conversation
- "Create in PROJECT-A" → PROJECT-A is now active
- "Create another" → Use PROJECT-A implicitly
- Explicit mention updates the active scope

### Context Expiration

After 5+ messages or 5+ minutes since last reference:
- Re-confirm rather than assume: "Do you mean RES-123 from earlier?"
- Don't guess when context is stale

---

## Common Workflows

{{COMMON_WORKFLOWS}}

### Data Passing Between Steps

When one skill's output feeds another:
- Capture entity IDs from responses (e.g., created resource key)
- State this explicitly: "Created RES-123. Now linking..."
- Reference captured data in subsequent operations

---

## Error Handling

If a skill fails:
- Report the error clearly
- Suggest recovery options
- Offer alternative approaches

If a skill is not available:
- Acknowledge the limitation
- Suggest alternatives from the Quick Reference table

### Permission Awareness

Before operations that might fail due to access:
- Check if user has mentioned permission issues before
- Suggest admin skill for permission checks when blocked

---

## Discoverability

- `/{{TOPIC}}-assistant-skills:browse-skills` - List all skills with descriptions
- `/{{TOPIC}}-assistant-skills:skill-info <name>` - Detailed skill information

If user asks "what can you do?" or similar:
- Show the Quick Reference table
- Offer to explain specific skills

---

## What This Hub Does NOT Do

- Execute operations directly (always delegates)
- Guess when uncertain (asks instead)
- Perform destructive operations without confirmation
- Route to deprecated or unavailable skills without warning
```

---

## Risk Level Guidelines

### Risk: `-` (Read-only/Safe)
- Search operations
- List/get operations
- Export operations
- Read-only queries

### Risk: `⚠️` (Destructive - Confirm)
- Create operations
- Update operations
- Delete single items
- Status transitions

### Risk: `⚠️⚠️` (High-risk - Confirm + Dry-run)
- Bulk delete operations
- Admin/permission changes
- Bulk updates (10+ items)
- Irreversible operations

---

## Negative Triggers Pattern

Negative triggers prevent misrouting by explicitly stating what each skill does NOT handle:

```markdown
| Skill | Does NOT handle | Route to instead |
|-------|-----------------|------------------|
| {{TOPIC}}-issue | Bulk (>10), search queries, admin | {{TOPIC}}-bulk, {{TOPIC}}-search, {{TOPIC}}-admin |
| {{TOPIC}}-search | Single item lookup, modifications | {{TOPIC}}-issue, {{TOPIC}}-bulk |
| {{TOPIC}}-bulk | Single item ops, search queries | {{TOPIC}}-issue, {{TOPIC}}-search |
| {{TOPIC}}-admin | Item CRUD, bulk operations | {{TOPIC}}-issue, {{TOPIC}}-bulk |
```

This pattern:
- Reduces routing errors by 40%+ (based on jira-assistant metrics)
- Helps Claude eliminate incorrect skills quickly
- Documents skill boundaries explicitly

---

## Disambiguation Pattern

Provide concrete examples of ambiguous requests with resolution:

```markdown
**"Show me the sprint"**
Could mean:
1. Sprint metadata (dates, goals) → {{TOPIC}}-agile
2. Items in the sprint → {{TOPIC}}-search

Ask: "Do you want sprint details or the items in the sprint?"

**"Update the item"**
Could mean:
1. Change fields on one item → {{TOPIC}}-issue
2. Transition status → {{TOPIC}}-lifecycle
3. Update multiple items → {{TOPIC}}-bulk

Ask: "What would you like to update - fields, status, or multiple items?"
```

---

## Workflow Documentation Pattern

```markdown
### Create Parent with Children
1. Use {{TOPIC}}-parent to create the parent → Note key (e.g., PAR-100)
2. Use {{TOPIC}}-issue to create each child with `--parent PAR-100`
3. Confirm: "Created parent PAR-100 with N children"

### Bulk Action from Search
1. Use {{TOPIC}}-search to find matching items
2. Use {{TOPIC}}-bulk with --dry-run to preview
3. Confirm count with user before executing
```

---

## Verification Checklist

After creating a router skill:

- [ ] All specialized skills listed in Quick Reference
- [ ] Risk levels assigned to all skills
- [ ] Negative triggers documented for each skill
- [ ] Disambiguation examples cover common ambiguities
- [ ] Context awareness rules documented
- [ ] Common workflows documented with data passing
- [ ] Error handling guidance included
- [ ] Discoverability commands documented
- [ ] Token budget under 200 lines
