# E2E Test Cases for Assistant-Skills Plugin
# Each test sends a prompt to Claude Code and validates the response

metadata:
  name: assistant-skills-e2e
  description: End-to-end tests for the assistant-skills Claude Code plugin
  version: "1.0.0"

# Global settings
settings:
  default_timeout: 120  # seconds
  default_model: claude-sonnet-4-20250514
  retry_on_timeout: 1

# Test suites organized by skill
suites:
  # ============================================
  # Plugin Installation Tests
  # ============================================
  plugin_installation:
    description: Verify plugin installs and loads correctly
    tests:
      - id: install_plugin
        name: Install plugin from local source
        prompt: "/plugin ."
        expect:
          success: true
          output_contains:
            - "assistant-skills"
          no_errors: true

      - id: verify_skills_loaded
        name: Verify all skills are discoverable
        prompt: "What skills do you have available from the assistant-skills plugin?"
        expect:
          success: true
          output_contains:
            - "assistant-builder"
            - "skills-optimizer"
            - "landing-page"
            - "library-publisher"
          no_errors: true

  # ============================================
  # Assistant Builder Skill Tests
  # ============================================
  assistant_builder:
    description: Test project scaffolding and skill creation
    tests:
      - id: list_templates
        name: List available templates
        prompt: "List the available templates for creating Assistant Skills projects"
        expect:
          success: true
          output_contains:
            - "template"
          no_errors: true

      - id: scaffold_dry_run
        name: Scaffold project in dry-run mode
        prompt: |
          Run the scaffold_project.py script in dry-run mode to create a test project called "Test-Skills" with topic "test" and API name "Test API". Show me what files would be created.
        expect:
          success: true
          output_contains:
            - "Test-Skills"
            - ".claude"
            - "SKILL.md"
          no_errors: true

      - id: validate_project
        name: Validate this project's structure
        prompt: "Validate this Assistant Skills project structure using the validate_project.py script"
        expect:
          success: true
          output_contains_any:
            - "valid"
            - "pass"
            - "success"
          no_errors: true

  # ============================================
  # Skills Optimizer Tests
  # ============================================
  skills_optimizer:
    description: Test token efficiency analysis
    tests:
      - id: analyze_skill
        name: Analyze a skill for token efficiency
        prompt: "Analyze the assistant-builder skill for token efficiency using the skills-optimizer"
        expect:
          success: true
          output_contains_any:
            - "grade"
            - "tokens"
            - "efficiency"
            - "score"
          no_errors: true

  # ============================================
  # Landing Page Tests
  # ============================================
  landing_page:
    description: Test README and branding generation
    tests:
      - id: analyze_project_metadata
        name: Analyze project for landing page generation
        prompt: "Analyze this project's metadata for landing page generation using the landing-page skill"
        expect:
          success: true
          output_contains_any:
            - "metadata"
            - "README"
            - "project"
          no_errors: true

  # ============================================
  # Library Publisher Tests
  # ============================================
  library_publisher:
    description: Test PyPI package publishing workflow
    tests:
      - id: analyze_library
        name: Analyze shared library structure
        prompt: "Analyze the shared library in this project using the library-publisher skill's analyze_library.py script"
        expect:
          success: true
          output_contains_any:
            - "module"
            - "library"
            - "export"
          no_errors: true

      - id: scaffold_package_dry_run
        name: Scaffold PyPI package in dry-run mode
        prompt: |
          Using the library-publisher skill, show me what files would be created if I scaffolded a PyPI package called "test-lib" from the shared library. Use dry-run mode.
        expect:
          success: true
          output_contains:
            - "pyproject.toml"
            - "src"
          no_errors: true

  # ============================================
  # Integration Tests
  # ============================================
  integration:
    description: Test cross-skill workflows
    tests:
      - id: full_project_workflow
        name: Simulate full project creation workflow
        prompt: |
          I want to create a new GitHub Assistant Skills project. Walk me through what the assistant-builder skill would create, but don't actually create any files. Just describe the structure.
        expect:
          success: true
          output_contains:
            - "skill"
            - "structure"
          no_errors: true

  # ============================================
  # Error Handling Tests
  # ============================================
  error_handling:
    description: Verify graceful error handling
    tests:
      - id: invalid_project_path
        name: Handle invalid project path gracefully
        prompt: "Validate the project at /nonexistent/path/that/does/not/exist using validate_project.py"
        expect:
          success: true
          output_contains_any:
            - "not found"
            - "does not exist"
            - "error"
            - "invalid"
          # This should NOT crash, just report the error gracefully
          no_crashes: true

      - id: missing_dependency_warning
        name: Warn about missing dependencies
        prompt: "What Python dependencies are required for the assistant-skills plugin?"
        expect:
          success: true
          output_contains:
            - "assistant-skills-lib"
          no_errors: true
