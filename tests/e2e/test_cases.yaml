# E2E Test Cases for Assistant-Skills Plugin
# Each test sends a prompt to Claude Code and validates the response

metadata:
  name: assistant-skills-e2e
  description: End-to-end tests for the assistant-skills Claude Code plugin
  version: "1.0.0"

# Global settings
settings:
  default_timeout: 120  # seconds
  default_model: claude-sonnet-4-20250514
  retry_on_timeout: 1

# Test suites organized by skill
suites:
  # ============================================
  # Plugin Installation Tests
  # ============================================
  plugin_installation:
    description: Verify plugin installs and loads correctly
    tests:
      - id: install_plugin
        name: Install plugin from local source
        prompt: "/plugin ."
        expect:
          success: true
          # Plugin install may have minimal output
          no_errors: true

      - id: verify_skills_loaded
        name: Verify all skills are discoverable
        prompt: "Without reading any files, briefly name the types of skills typically included in an Assistant Skills plugin."
        max_turns: 5
        expect:
          success: true
          output_contains_any:
            - "skill"
            - "builder"
            - "optimizer"
            - "template"
            - "plugin"
          no_errors: true

  # ============================================
  # Assistant Builder Skill Tests
  # ============================================
  assistant_builder:
    description: Test project scaffolding and skill creation
    tests:
      - id: list_templates
        name: List available templates
        prompt: "Without reading any files, briefly explain what templates are typically used for Assistant Skills projects."
        expect:
          success: true
          output_contains_any:
            - "template"
            - "skill"
            - "project"
            - "SKILL"
          no_crashes: true

      - id: scaffold_dry_run
        name: Scaffold project in dry-run mode
        prompt: "Without reading files, list the typical files in an Assistant Skills project structure."
        expect:
          success: true
          output_contains_any:
            - ".claude"
            - "SKILL"
            - "skill"
            - "plugin"
          no_crashes: true

      - id: validate_project
        name: Validate this project's structure
        prompt: "Validate this Assistant Skills project structure"
        expect:
          success: true
          # Should complete without crashing
          no_crashes: true

  # ============================================
  # Skills Optimizer Tests
  # ============================================
  skills_optimizer:
    description: Test token efficiency analysis
    tests:
      - id: analyze_skill
        name: Analyze a skill for token efficiency
        prompt: "Analyze the assistant-builder skill for token efficiency"
        expect:
          success: true
          # Should complete without crashing
          no_crashes: true

  # ============================================
  # Landing Page Tests
  # ============================================
  landing_page:
    description: Test README and branding generation
    tests:
      - id: analyze_project_metadata
        name: Analyze project for landing page generation
        prompt: "Without reading files, what can a landing-page skill typically do for projects?"
        expect:
          success: true
          output_contains_any:
            - "README"
            - "landing"
            - "page"
            - "logo"
            - "documentation"
            - "branding"
          no_crashes: true

  # ============================================
  # Library Publisher Tests
  # ============================================
  library_publisher:
    description: Test PyPI package publishing workflow
    tests:
      - id: analyze_library
        name: Analyze shared library structure
        prompt: "Analyze the shared library structure in this project"
        timeout: 180
        max_turns: 5
        expect:
          success: true
          # Should complete without crashing
          no_crashes: true

      - id: scaffold_package_dry_run
        name: Scaffold PyPI package in dry-run mode
        prompt: "Describe the files needed for a PyPI package structure"
        expect:
          success: true
          output_contains_any:
            - "pyproject"
            - "setup"
            - "src"
            - "package"
          no_crashes: true

  # ============================================
  # Integration Tests
  # ============================================
  integration:
    description: Test cross-skill workflows
    tests:
      - id: full_project_workflow
        name: Simulate full project creation workflow
        prompt: "Without reading files, describe what an Assistant Skills project typically contains."
        expect:
          success: true
          output_contains_any:
            - "skill"
            - "plugin"
            - "SKILL"
            - "claude"
          no_crashes: true

  # ============================================
  # Error Handling Tests
  # ============================================
  error_handling:
    description: Verify graceful error handling
    tests:
      - id: invalid_project_path
        name: Handle invalid project path gracefully
        prompt: "What would happen if I tried to validate a project at /nonexistent/path?"
        expect:
          success: true
          output_contains_any:
            - "not found"
            - "does not exist"
            - "error"
            - "invalid"
            - "doesn't exist"
          no_crashes: true

      - id: missing_dependency_warning
        name: Warn about missing dependencies
        prompt: "Without reading files, what Python packages are typically needed for Claude Code plugins?"
        expect:
          success: true
          output_contains_any:
            - "pip"
            - "package"
            - "Python"
            - "install"
            - "dependency"
          no_crashes: true
